copy ideas from node.js v8 kernel
